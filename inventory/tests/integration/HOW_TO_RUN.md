# üß™ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è Inventory Service

## ‚ö†Ô∏è –í–ê–ñ–ù–û: Docker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–í —Ç–µ–∫—É—â–µ–π —Å—Ä–µ–¥–µ Docker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ—ç—Ç–æ–º—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã.

## ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (—Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ Docker)
```bash
cd inventory/tests/unit
go test -v -timeout=20m -tags=unit .
```

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–°–æ–∑–¥–∞–Ω .env —Ñ–∞–π–ª**
- –ü—É—Ç—å: `deploy/compose/inventory/.env`
- –°–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### 2. **–î–æ–±–∞–≤–ª–µ–Ω—ã unit —Ç–µ—Å—Ç—ã**
- –§–∞–π–ª: `inventory/tests/unit/inventory_unit_test.go`
- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –†–∞–±–æ—Ç–∞—é—Ç –≤ CI/CD –±–µ–∑ Docker

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- Go –º–æ–¥—É–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Taskfile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£–±–µ–¥–∏—Å—å, —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω
docker ps

# –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã
task test-integration MODULES=inventory
```

### –°–ø–æ—Å–æ–± 2: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ go test

```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
cd inventory/tests/integration

# –ó–∞–ø—É—Å—Ç–∏ —Å —Ç–µ–≥–æ–º integration –ò —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º
go test -v -timeout=20m -tags=integration .
```

**–í–∞–∂–Ω–æ:** `-timeout=20m` –Ω—É–∂–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 3-5 –º–∏–Ω—É—Ç
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π timeout Go test = 10 –º–∏–Ω—É—Ç (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!)
- –ù–∞—à timeout = 20 –º–∏–Ω—É—Ç (—Å –∑–∞–ø–∞—Å–æ–º)

---

## üîç –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –≤—Å–µ –µ—â–µ –ø–∞–¥–∞—é—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω

```bash
docker ps
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π)
```

### 2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞

–í **–¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ** –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:

```bash
# –°–º–æ—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps --filter "label=org.testcontainers=true"

# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ MongoDB
docker logs <mongo_container_id>

# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker logs <app_container_id>
```

### 3. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏

```bash
# –ù–∞–π–¥–∏ —Å–µ—Ç—å
docker network ls | grep inventory

# –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å–µ—Ç–∏
docker network inspect <network_name>
```

### 4. –í—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB

```bash
# 1. –°–æ–∑–¥–∞–π —Å–µ—Ç—å
docker network create test-network

# 2. –ó–∞–ø—É—Å—Ç–∏ MongoDB
docker run -d --name test-mongo \
  --network test-network \
  -e MONGO_INITDB_ROOT_USERNAME=inventory-user \
  -e MONGO_INITDB_ROOT_PASSWORD=inventory-password \
  mongo:8.0

# 3. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker run --rm \
  --network test-network \
  -e GRPC_PORT=50051 \
  -e MONGO_HOST=test-mongo \
  -e MONGO_PORT=27017 \
  -e MONGO_DATABASE=inventory-service \
  -e MONGO_INITDB_ROOT_USERNAME=inventory-user \
  -e MONGO_INITDB_ROOT_PASSWORD=inventory-password \
  -e MONGO_AUTH_DB=admin \
  -e LOGGER_LEVEL=debug \
  -e LOGGER_AS_JSON=true \
  test-inventory:latest

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB —á–µ—Ä–µ–∑ 1-2 –ø–æ–ø—ã—Ç–∫–∏
# –í –ª–æ–≥–∞—Ö —É–≤–∏–¥–∏—à—å: "Successfully connected to MongoDB (attempt X)"
```

### 5. –û—á–∏—Å—Ç–∏ Docker –∫–µ—à (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏ –≤—Å–µ testcontainers
docker ps -a --filter "label=org.testcontainers=true" --format "{{.ID}}" | xargs -r docker rm -f

# –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker images | grep inventory | awk '{print $3}' | xargs -r docker rmi -f

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏ –æ–±—Ä–∞–∑
docker build -f deploy/docker/inventory/Dockerfile -t test-inventory:latest .
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã:

1. ‚úÖ **–°–æ–∑–¥–∞—Ç—å Docker —Å–µ—Ç—å** (~1 —Å–µ–∫—É–Ω–¥–∞)
2. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å MongoDB –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (~5 —Å–µ–∫—É–Ω–¥)
3. ‚úÖ **–°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (~3-5 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, –ø–æ—Ç–æ–º –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–µ—à—É)
4. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (~2 —Å–µ–∫—É–Ω–¥—ã)
5. ‚úÖ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MongoDB** (1-3 –ø–æ–ø—ã—Ç–∫–∏, ~2-6 —Å–µ–∫—É–Ω–¥)
6. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã** (~10-30 —Å–µ–∫—É–Ω–¥)
7. ‚úÖ **–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (~2 —Å–µ–∫—É–Ω–¥—ã)

**–û–±—â–µ–µ –≤—Ä–µ–º—è**: 4-7 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ, 30-60 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫–µ—à—É Docker).

---

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏

- **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–¥–∞ –¥–æ–ª–≥–∏–π** ‚Äî Docker —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑—ã –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –±—ã—Å—Ç—Ä—ã–µ** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–µ—à
- **–ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç**: —É–≤–µ–ª–∏—á—å `startupTimeout` –≤ `setup.go` (—Å–µ–π—á–∞—Å 5 –º–∏–Ω—É—Ç)
- **–ï—Å–ª–∏ MongoDB –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å**: —É–≤–µ–ª–∏—á—å `maxRetries` –≤ `di.go` (—Å–µ–π—á–∞—Å 10 –ø–æ–ø—ã—Ç–æ–∫)

---

## üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è

1. **–ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω retry –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ MongoDB?**
2. **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–∫–∞–∂—É—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö Docker —Å–µ—Ç—è—Ö?**
3. **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω build tag `//go:build integration`?**

–£–¥–∞—á–∏! üöÄ

